<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login – Fynn Hofmann</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="styles.css">

  <script>
    /* Redirect immediately if already authenticated */
    if (sessionStorage.getItem('fh_auth') === 'fh_authed_2026') {
      document.location.replace('secure/index.html');
    }
  </script>
</head>
<body class="login-page">

  <main class="login-wrap">
    <div class="login-card reveal" style="opacity:1;transform:none">

      <a href="index.html" class="login-back">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2.5"
             stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
        Zurück zur Website
      </a>

      <div class="login-logo">FH</div>
      <h1 class="login-title">Willkommen zurück.</h1>
      <p class="login-sub">Melde dich mit deinem lokalen Konto an.</p>

      <form class="login-form" id="loginForm" autocomplete="off" novalidate>

        <!-- Username -->
        <div class="login-field">
          <label for="username" class="login-label">Benutzername</label>
          <input type="text" id="username" name="username"
                 class="login-input" autocomplete="username"
                 placeholder="Benutzername" required spellcheck="false">
        </div>

        <!-- Password -->
        <div class="login-field">
          <label for="password" class="login-label">Passwort</label>
          <div class="login-pw-wrap">
            <input type="password" id="password" name="password"
                   class="login-input" autocomplete="current-password"
                   placeholder="Passwort" required>
            <button type="button" class="login-pw-toggle" id="pwToggle"
                    aria-label="Passwort anzeigen/verbergen">
              <!-- Eye open -->
              <svg id="iconEye" width="18" height="18" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <!-- Eye closed (hidden by default) -->
              <svg id="iconEyeOff" width="18" height="18" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round"
                   style="display:none">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20
                         c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94
                         M9.9 4.24A9.12 9.12 0 0 1 12 4
                         c7 0 11 8 11 8
                         a18.5 18.5 0 0 1-2.16 3.19
                         m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Error message -->
        <div class="login-error" id="loginError" role="alert"
             aria-live="polite"></div>

        <!-- Submit -->
        <button type="submit" class="btn-primary login-submit"
                id="loginSubmit">
          Anmelden
        </button>

      </form>
    </div>
  </main>

  <script>
    /* ── Credentials (password stored as SHA-256 hash) ──── */
    var CORRECT_USER = 'fynnhofmann';
    var CORRECT_HASH = 'c920ef6facaefacc34dfc991b6551be145eb444e58c15e57b9783c4a7adc7569';
    var SESSION_KEY  = 'fh_auth';
    var SESSION_VAL  = 'fh_authed_2026';

    /* ── SHA-256 via Web Crypto API ─────────────────────── */
    async function sha256(str) {
      var buf = await crypto.subtle.digest(
        'SHA-256',
        new TextEncoder().encode(str)
      );
      return Array.from(new Uint8Array(buf))
        .map(function(b){ return b.toString(16).padStart(2,'0'); })
        .join('');
    }

    /* ── Password visibility toggle ─────────────────────── */
    var pwField  = document.getElementById('password');
    var toggle   = document.getElementById('pwToggle');
    var iconEye  = document.getElementById('iconEye');
    var iconOff  = document.getElementById('iconEyeOff');

    toggle.addEventListener('click', function() {
      var show = pwField.type === 'password';
      pwField.type     = show ? 'text' : 'password';
      iconEye.style.display = show ? 'none'  : '';
      iconOff.style.display = show ? ''      : 'none';
      pwField.focus();
    });

    /* ── Login submit ───────────────────────────────────── */
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      var btn = document.getElementById('loginSubmit');
      var err = document.getElementById('loginError');

      btn.disabled    = true;
      btn.textContent = 'Überprüfe …';
      err.textContent = '';

      var user = document.getElementById('username').value.trim();
      var pass = document.getElementById('password').value;

      /* Minimum 400 ms delay prevents brute-force timing */
      var [hash] = await Promise.all([
        sha256(pass),
        new Promise(function(r){ setTimeout(r, 420); })
      ]);

      if (user === CORRECT_USER && hash === CORRECT_HASH) {
        sessionStorage.setItem(SESSION_KEY, SESSION_VAL);
        window.location.replace('secure/index.html');
      } else {
        err.textContent = 'Benutzername oder Passwort falsch.';

        /* Shake animation */
        var card = document.querySelector('.login-card');
        card.classList.add('login-shake');
        card.addEventListener('animationend', function() {
          card.classList.remove('login-shake');
        }, { once: true });

        btn.disabled    = false;
        btn.textContent = 'Anmelden';
        document.getElementById('password').value = '';
        document.getElementById('password').focus();
      }
    });

    /* Show logout success hint */
    if (new URLSearchParams(location.search).get('logout') === '1') {
      var err = document.getElementById('loginError');
      err.style.color  = '#34c759';
      err.textContent  = 'Du wurdest erfolgreich abgemeldet.';
    }
  </script>

</body>
</html>
